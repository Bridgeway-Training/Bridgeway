<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bridgeway ¬∑ App de actividades de ingl√©s</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            bwNavy: '#1D2D44',
            bwTeal: '#3FC7BE',
          },
          boxShadow: {
            'soft': '0 10px 30px rgba(0,0,0,.08)',
            'glow': '0 0 0 3px rgba(63,199,190,.25)',
          },
          keyframes: {
            pop: { '0%':{ transform:'scale(.95)'}, '60%':{ transform:'scale(1.02)'}, '100%':{ transform:'scale(1)'} },
            pulseLine: { '0%':{ transform:'translateX(-100%)'}, '100%':{ transform:'translateX(200%)'} },
            slideUp: { '0%':{ transform:'translateY(10px)', opacity:0 }, '100%':{ transform:'translateY(0)', opacity:1 } },
            bounceTap: { '0%':{ transform:'scale(1)'}, '40%':{ transform:'scale(.98)'}, '100%':{ transform:'scale(1)'} },
          },
          animation: {
            pop: 'pop .4s ease-out',
            slideUp: 'slideUp .35s ease both',
            bounceTap: 'bounceTap .15s ease-out',
          }
        }
      }
    };
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root { --bw-navy:#1D2D44; --bw-teal:#3FC7BE; }
    html, body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    /* Fondo con los colores Bridgeway */
    .bridgeway-bg::before {
      content:''; position:absolute; inset:0;
      background: linear-gradient(120deg, var(--bw-navy) 0%, #24364f 35%, var(--bw-teal) 100%);
      opacity:.12; pointer-events:none;
    }
    .focus-ring:focus { outline: 3px solid var(--bw-teal); outline-offset: 2px; }
    .disabled { pointer-events: none; opacity: .65; }
    /* Ripple */
    .ripple {
      position:absolute; border-radius:50%; transform: scale(0);
      animation: ripple 600ms linear; background: rgba(63,199,190,.35);
      pointer-events:none;
    }
    @keyframes ripple { to { transform: scale(4); opacity:0; } }
    /* Confetti */
    .confetti { position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 60; }
    .confetti span {
      position: absolute; width: 10px; height: 14px; will-change: transform, opacity;
    }
    @keyframes fall {
      0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
      100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
    }
    /* Toast */
    .toast { position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); z-index: 70; }
  </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 min-h-screen relative">
  <!-- ‚ú® Fondo de marca -->
  <div class="absolute inset-0 bridgeway-bg"></div>

  <!-- üî∑ Cabecera -->
  <header class="relative z-20 bg-white/90 dark:bg-slate-900/80 backdrop-blur shadow-soft">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <!-- Reemplaza src por tu logo si quieres usar archivo externo -->
        <img src="" alt="Logo Bridgeway" class="h-10 w-auto rounded-md" />
        <div>
          <h1 class="text-xl font-extrabold tracking-tight">
            <span class="text-bwNavy">Bridge</span><span class="text-bwTeal">way</span> ¬∑ App de actividades de ingl√©s
          </h1>
          <p class="text-xs text-slate-600 dark:text-slate-300">Adverbs of Frequency ¬∑ Present Simple (3rd person) ¬∑ Editing Practice</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button id="clearStorageBtn" class="focus-ring px-3 py-2 rounded-xl text-sm bg-white border hover:shadow-glow dark:bg-slate-800" aria-label="Borrar datos guardados" title="Borrar datos (localStorage)">
          üßπ Borrar datos
        </button>
        <button id="resetAllBtn" class="focus-ring px-3 py-2 rounded-xl text-sm bg-white border hover:shadow-glow dark:bg-slate-800" aria-label="Reiniciar todo">
          üîÑ Reiniciar todo
        </button>
        <label class="inline-flex items-center gap-2 text-sm cursor-pointer select-none ml-2" aria-label="Cambiar tema">
          <input id="themeToggle" type="checkbox" class="sr-only" />
          <span class="h-5 w-9 bg-slate-300 dark:bg-slate-700 rounded-full relative shadow-inner">
            <span class="dot absolute left-0 top-0 h-5 w-5 bg-white dark:bg-slate-200 rounded-full shadow transition-transform translate-x-0 dark:translate-x-4"></span>
          </span>
          <span class="text-slate-700 dark:text-slate-300">Modo oscuro</span>
        </label>
      </div>
    </div>
    <!-- L√≠nea animada de marca -->
    <div class="relative h-[3px] overflow-hidden bg-gradient-to-r from-bwNavy to-bwTeal">
      <div class="absolute inset-y-0 -translate-x-full w-1/3 bg-white/40 animate-[pulseLine_2s_linear_infinite]"></div>
    </div>
  </header>

  <main class="relative z-10 max-w-6xl mx-auto px-4 py-6">
    <!-- üí™ Motivaci√≥n + progreso global -->
    <section class="mb-6">
      <div class="rounded-2xl p-4 bg-white/80 dark:bg-slate-800/80 border">
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
          <div>
            <h2 class="font-semibold text-bwNavy dark:text-bwTeal mb-1">¬°Vamos a tope!</h2>
            <p class="text-sm text-slate-700 dark:text-slate-300">Elige una secci√≥n y responde. Feedback instant√°neo, micro-interacciones y motivaci√≥n constante üí™</p>
          </div>
          <div class="flex items-center gap-2">
            <button id="resetSectionBtn" class="focus-ring px-3 py-2 rounded-xl bg-bwTeal/10 text-bwNavy border hover:shadow-glow">üîÅ Reiniciar secci√≥n activa</button>
            <button id="resetAllBtn2" class="focus-ring px-3 py-2 rounded-xl bg-bwNavy text-white hover:opacity-90">üîÑ Reiniciar todo</button>
          </div>
        </div>
        <div class="mt-4">
          <div class="h-2 w-full bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
            <div id="global-progress" class="h-2 bg-gradient-to-r from-bwNavy to-bwTeal w-0 transition-all"></div>
          </div>
          <div id="global-stats" class="mt-2 text-sm" aria-live="polite"></div>
        </div>
      </div>
    </section>

    <!-- üß≠ Tabs / secciones -->
    <div role="tablist" aria-label="Secciones" class="mb-4 grid grid-cols-1 sm:grid-cols-3 gap-3">
      <button role="tab" id="tab-adv" class="tab focus-ring px-4 py-3 rounded-2xl border bg-white dark:bg-slate-800 text-left shadow-soft data-[active=true]:ring-2 data-[active=true]:ring-bwTeal" data-target="panel-adv">
        <span class="font-semibold">Adverbs of Frequency</span>
        <span class="block text-xs text-slate-500">12 √≠tems ¬∑ huecos</span>
      </button>
      <button role="tab" id="tab-pres" class="tab focus-ring px-4 py-3 rounded-2xl border bg-white dark:bg-slate-800 text-left shadow-soft" data-target="panel-pres">
        <span class="font-semibold">Present Simple ‚Äì 3rd person</span>
        <span class="block text-xs text-slate-500">Reglas -s/-es/-ies</span>
      </button>
      <button role="tab" id="tab-edit" class="tab focus-ring px-4 py-3 rounded-2xl border bg-white dark:bg-slate-800 text-left shadow-soft" data-target="panel-edit">
        <span class="font-semibold">Editing Practice</span>
        <span class="block text-xs text-slate-500">20 correcciones</span>
      </button>
    </div>

    <!-- üìÑ Panel 1 -->
    <section id="panel-adv" role="tabpanel" class="panel rounded-2xl border bg-white/90 dark:bg-slate-800/80 p-4 shadow-soft animate-pop">
      <header class="flex items-center gap-4 mb-4">
        <!-- Sustituye por tu miniatura si lo deseas -->
        <img src="" alt="Miniatura ficha: Adverbs of Frequency" class="h-16 w-16 rounded-xl object-cover border" />
        <div>
          <h3 class="text-xl font-bold">Adverbs of Frequency</h3>
          <p class="text-sm text-slate-600 dark:text-slate-300">Completa los 12 huecos de la ficha con el mejor adverbio de frecuencia.</p>
        </div>
      </header>
      <div class="mb-3">
        <div class="h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
          <div id="adv-progress" class="h-2 bg-bwTeal w-0 transition-all"></div>
        </div>
      </div>
      <div id="adv-quiz" class="quiz space-y-4" aria-live="polite"></div>
      <footer class="mt-6 flex flex-wrap items-center justify-between gap-3">
        <div class="text-sm" id="adv-stats" aria-live="polite"></div>
        <div class="flex gap-2">
          <button class="btn-retry focus-ring px-3 py-2 rounded-xl bg-bwNavy text-white hover:opacity-90" data-section="adv">Reintentar secci√≥n</button>
        </div>
      </footer>
    </section>

    <!-- üìÑ Panel 2 -->
    <section id="panel-pres" role="tabpanel" class="panel hidden rounded-2xl border bg-white/90 dark:bg-slate-800/80 p-4 shadow-soft animate-pop">
      <header class="flex items-center gap-4 mb-4">
        <img src="" alt="Miniatura ficha: Present Simple 3rd Person" class="h-16 w-16 rounded-xl object-cover border" />
        <div>
          <h3 class="text-xl font-bold">Present Simple ‚Äì 3¬™ persona</h3>
          <p class="text-sm text-slate-600 dark:text-slate-300">Reglas -s/-es/-ies, excepciones y casos especiales.</p>
        </div>
      </header>
      <div class="mb-3">
        <div class="h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
          <div id="pres-progress" class="h-2 bg-bwTeal w-0 transition-all"></div>
        </div>
      </div>
      <div id="pres-quiz" class="quiz space-y-4" aria-live="polite"></div>
      <footer class="mt-6 flex flex-wrap items-center justify-between gap-3">
        <div class="text-sm" id="pres-stats" aria-live="polite"></div>
        <div class="flex gap-2">
          <button class="btn-retry focus-ring px-3 py-2 rounded-xl bg-bwNavy text-white hover:opacity-90" data-section="pres">Reintentar secci√≥n</button>
        </div>
      </footer>
    </section>

    <!-- üìÑ Panel 3 -->
    <section id="panel-edit" role="tabpanel" class="panel hidden rounded-2xl border bg-white/90 dark:bg-slate-800/80 p-4 shadow-soft animate-pop">
      <header class="flex items-center gap-4 mb-4">
        <img src="" alt="Miniatura ficha: Editing Practice" class="h-16 w-16 rounded-xl object-cover border" />
        <div>
          <h3 class="text-xl font-bold">Editing Practice ‚Äì Add -s/-es/-ies</h3>
          <p class="text-sm text-slate-600 dark:text-slate-300">Corrige las 20 oraciones del texto en 3¬™ persona.</p>
        </div>
      </header>
      <div class="mb-3">
        <div class="h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
          <div id="edit-progress" class="h-2 bg-bwTeal w-0 transition-all"></div>
        </div>
      </div>
      <div id="edit-quiz" class="quiz space-y-4" aria-live="polite"></div>
      <footer class="mt-6 flex flex-wrap items-center justify-between gap-3">
        <div class="text-sm" id="edit-stats" aria-live="polite"></div>
        <div class="flex gap-2">
          <button class="btn-retry focus-ring px-3 py-2 rounded-xl bg-bwNavy text-white hover:opacity-90" data-section="edit">Reintentar secci√≥n</button>
        </div>
      </footer>
    </section>
  </main>

  <!-- Confetti / Toast containers -->
  <div id="confetti" class="confetti"></div>
  <div id="toast" class="toast hidden"></div>

  <script>
  // ===== Utilidades b√°sicas =====
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => [...root.querySelectorAll(sel)];
  const shuffle = (arr) => arr.map(v => [Math.random(), v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);
  const STORAGE_KEY = 'eng-practice-v2';

  // --- Ripple, toasts y confetti (motivaci√≥n) ---
  function addRipple(e) {
    const btn = e.currentTarget;
    const rect = btn.getBoundingClientRect();
    const ripple = document.createElement('span');
    ripple.className = 'ripple';
    const size = Math.max(rect.width, rect.height);
    ripple.style.width = ripple.style.height = size + 'px';
    ripple.style.left = (e.clientX - rect.left - size/2) + 'px';
    ripple.style.top = (e.clientY - rect.top - size/2) + 'px';
    btn.appendChild(ripple);
    setTimeout(()=>ripple.remove(), 600);
  }
  function showToast(msg, positive=true) {
    const t = $('#toast');
    t.className = 'toast px-4 py-2 rounded-xl text-sm shadow-soft border animate-slideUp ' + (positive ? 'bg-white text-bwNavy border-bwTeal' : 'bg-white text-rose-700 border-rose-300');
    t.textContent = msg;
    t.classList.remove('hidden');
    setTimeout(()=> t.classList.add('hidden'), 1600);
  }
  function confettiBurst() {
    const c = $('#confetti');
    c.innerHTML = '';
    const colors = ['#1D2D44', '#3FC7BE', '#ffffff', '#58D5C9'];
    for (let i=0;i<60;i++) {
      const s = document.createElement('span');
      s.style.left = Math.random()*100 + 'vw';
      s.style.background = colors[Math.floor(Math.random()*colors.length)];
      s.style.transform = 'translateY(-10vh)';
      s.style.animation = `fall ${800 + Math.random()*900}ms ease-out forwards`;
      s.style.opacity = 1;
      s.style.borderRadius = Math.random() > .5 ? '2px' : '50%';
      c.appendChild(s);
    }
    setTimeout(()=>{ c.innerHTML=''; }, 1200);
  }

  // --- Persistencia ---
  const loadState = () => JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  const saveState = (state) => localStorage.setItem(STORAGE_KEY, JSON.stringify(state));

  // ======= Preguntas (de las tres fichas) =======
  // Ficha 1: Adverbs of Frequency (12)
  const advQuestions = [
    { prompt: "1) My brother is never sad. He‚Äôs ________________ happy.", options: ["always", "usually", "often", "sometimes"], correctIndex: 0, explanation: "Si nunca est√° triste, entonces est√° 'always' happy." },
    { prompt: "2) I was late for work only one time last year. I‚Äôm ________________ late.", options: ["rarely", "always", "often", "sometimes"], correctIndex: 0, explanation: "'Only one time' sugiere 'rarely'." },
    { prompt: "3) Mary failed only one test in high school. She ________________ passed her tests.", options: ["almost always", "never", "hardly ever", "seldom"], correctIndex: 0, explanation: "Si solo reprob√≥ una vez, 'almost always' aprob√≥." },
    { prompt: "4) I always remember to do my homework. I ________________ forget to do it.", options: ["never", "often", "sometimes", "usually"], correctIndex: 0, explanation: "'Always remember' implica 'never forget'." },
    { prompt: "5) Steven seldom goes to a cinema. He ________________ sees movies.", options: ["rarely", "always", "usually", "often"], correctIndex: 0, explanation: "Si 'seldom' va al cine, 'rarely' ve pel√≠culas." },
    { prompt: "6) Judy saw a doctor for the first time in three years. She ________________ gets sick.", options: ["hardly ever", "often", "usually", "always"], correctIndex: 0, explanation: "Primera vez en tres a√±os ‚áí 'hardly ever'." },
    { prompt: "7) I get up at five o‚Äôclock seven days a week. I ________________ get up early.", options: ["always", "sometimes", "often", "usually"], correctIndex: 0, explanation: "Todos los d√≠as ‚áí 'always'." },
    { prompt: "8) It‚Äôs always hot and sunny where I live. That‚Äôs why I ________________ see snow.", options: ["never", "often", "sometimes", "usually"], correctIndex: 0, explanation: "Si siempre hace calor y sol ‚áí 'never' ver nieve." },
    { prompt: "9) A: Do you ever drink coffee? B: Yes, but only ________________, not often.", options: ["sometimes", "always", "usually", "never"], correctIndex: 0, explanation: "'Only ... not often' ‚áí 'sometimes'." },
    { prompt: "10) My sister almost never eats burgers and fries. She ________________ eats healthy foods.", options: ["usually", "rarely", "never", "hardly ever"], correctIndex: 0, explanation: "Si casi nunca come comida basura, 'usually' come sano." },
    { prompt: "11) I ________________ take a bus to class, maybe three or four days a week.", options: ["often", "always", "never", "hardly ever"], correctIndex: 0, explanation: "3 o 4 d√≠as/semana ‚áí 'often'." },
    { prompt: "12) A: Do you ever watch action movies? B: No, never. Well, I watched an action movie a few years ago, so I guess should say ________________.", options: ["hardly ever", "always", "often", "usually"], correctIndex: 0, explanation: "Casi nunca ‚áí 'hardly ever'." },
  ];

  // Ficha 2: Present Simple ‚Äì 3rd person (15)
  const presQuestions = [
    { prompt: "Elige la forma correcta en 3¬™ persona: He ____ TV. (watch)", options: ["watch", "watches", "watchs", "watchez"], correctIndex: 1, explanation: "Verbos en -tch a√±aden -es: 'watches'." },
    { prompt: "Completa: She ____ English. (teach)", options: ["teachs", "teaches", "teach", "teachies"], correctIndex: 1, explanation: "Verbos en -ch a√±aden -es." },
    { prompt: "Elige la forma correcta: He ____ his clothes. (wash)", options: ["wash", "washes", "washs", "washez"], correctIndex: 1, explanation: "Verbos en -sh a√±aden -es." },
    { prompt: "3¬™ persona: She ____ her friends. (miss)", options: ["miss", "misses", "misss", "mises"], correctIndex: 1, explanation: "Verbos en -ss a√±aden -es." },
    { prompt: "3¬™ persona: He ____ to school. (go)", options: ["goes", "gos", "go", "goe"], correctIndex: 0, explanation: "Verbos en -o a√±aden -es ‚áí 'goes'." },
    { prompt: "3¬™ persona: She ____ bicycles. (fix)", options: ["fixes", "fixs", "fix", "fixies"], correctIndex: 0, explanation: "Verbos en -x a√±aden -es." },
    { prompt: "Consonante + y ‚Üí -ies: He ____ too much. (worry)", options: ["worrys", "worries", "worrie", "worriez"], correctIndex: 1, explanation: "Consonante+y ‚áí cambia a -ies." },
    { prompt: "Consonante + y ‚Üí -ies: She ____ to work. (hurry)", options: ["hurrys", "hurries", "hurry", "huries"], correctIndex: 1, explanation: "Consonante+y ‚áí 'hurries'." },
    { prompt: "Consonante + y ‚Üí -ies: He ____ English. (study)", options: ["studies", "studys", "study", "studyies"], correctIndex: 0, explanation: "Consonante+y ‚áí 'studies'." },
    { prompt: "Vocal + y (no cambio): She ____ soccer. (play)", options: ["plays", "plaies", "play", "playes"], correctIndex: 0, explanation: "Vocal+y ‚áí solo -s: 'plays'." },
    { prompt: "Vocal + y (no cambio): He ____ lunch. (buy)", options: ["buys", "buyes", "buy", "buies"], correctIndex: 0, explanation: "Vocal+y ‚áí 'buys'." },
    { prompt: "Verbo irregular: She ____ two cats. (have)", options: ["have", "haves", "has", "hases"], correctIndex: 2, explanation: "Irregular: 'has'." },
    { prompt: "No cambies en preguntas: ____ she work?", options: ["Does", "Do", "Is", "Has"], correctIndex: 0, explanation: "En preguntas con 'do/does', el verbo principal no cambia: 'Does she work?'." },
    { prompt: "Negativa correcta: He ____ watch TV.", options: ["doesn't", "don't", "isn't", "hasn't"], correctIndex: 0, explanation: "Negativa con 'doesn't' + verbo base: 'doesn't watch'." },
    { prompt: "Modales (no cambian el verbo): She ____ fix bicycles.", options: ["can", "cans", "musts", "shoulds"], correctIndex: 0, explanation: "Con modales ('can/should/must'), el verbo va en forma base." },
  ];

  // Ficha 3: Editing Practice (20)
  const editQuestions = [
    { prompt: "Corrige: ‚Äú‚Ä¶but he like it.‚Äù", options: ["he likes it", "he like it", "he liked it", "he like‚Äôs it"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'likes' (dado en la ficha)." },
    { prompt: "Corrige: ‚ÄúHe usually get up ‚Ä¶‚Äù", options: ["He usually gets up", "He usually get up", "He usually is get up", "He usually getting up"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'gets'." },
    { prompt: "Corrige: ‚Äú‚Ä¶after his alarm clock wake him up.‚Äù", options: ["wakes", "wake", "waked", "is wake"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'wakes'." },
    { prompt: "Corrige: ‚ÄúFirst, he brush his teeth ‚Ä¶‚Äù", options: ["brushes", "brush", "is brushing", "brushed"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'brushes'." },
    { prompt: "Corrige: ‚Äú‚Ä¶and shave and wash his face.‚Äù", options: ["shaves and washes", "shave and washes", "shaves and wash", "shave and wash"], correctIndex: 0, explanation: "Ambos verbos en 3¬™ persona: 'shaves and washes'." },
    { prompt: "Corrige: ‚ÄúThen, he get dressed ‚Ä¶‚Äù", options: ["he gets dressed", "he get dressed", "he is get dressed", "he getting dressed"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'gets'." },
    { prompt: "Corrige: ‚Äú‚Ä¶and go downstairs‚Ä¶‚Äù", options: ["goes downstairs", "go downstairs", "is go downstairs", "going downstairs"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'goes'." },
    { prompt: "Corrige: ‚ÄúHe take a bus to work ‚Ä¶‚Äù", options: ["He takes a bus", "He take a bus", "He taking a bus", "He is take a bus"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'takes'." },
    { prompt: "Corrige: ‚Äú‚Ä¶and he always arrive at his office‚Ä¶‚Äù", options: ["arrives", "arrive", "is arrive", "arriving"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'arrives'." },
    { prompt: "Corrige: ‚Äú‚Ä¶because he finish work and hurry back home‚Ä¶‚Äù", options: ["finishes and hurries", "finish and hurries", "finishes and hurry", "finish and hurry"], correctIndex: 0, explanation: "Ambos verbos en 3¬™ persona." },
    { prompt: "Corrige: ‚Äú‚Ä¶and see his wife and children again.‚Äù", options: ["sees", "see", "is see", "seeing"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'sees'." },
    { prompt: "Corrige: ‚Äú‚Ä¶after that he spend time with his wife and kids‚Ä¶‚Äù", options: ["he spends time", "he spend time", "he is spend time", "he spending time"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'spends'." },
    { prompt: "Corrige: ‚Äú‚Ä¶he do exercise in the evening‚Ä¶‚Äù", options: ["he does exercise", "he do exercise", "he is do exercise", "he doing exercise"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'does'." },
    { prompt: "Corrige: ‚ÄúHe think that this is very important!‚Äù", options: ["He thinks", "He think", "He is think", "He thinking"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'thinks'." },
    { prompt: "Corrige: ‚Äú‚Ä¶at about 9:30, he go to bed‚Ä¶‚Äù", options: ["he goes to bed", "he go to bed", "he going to bed", "he is go to bed"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'goes'." },
    { prompt: "Corrige: ‚Äú‚Ä¶read for a while‚Ä¶‚Äù", options: ["reads", "read", "is read", "reading"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'reads'." },
    { prompt: "Corrige: ‚Äú‚Ä¶and then fall asleep.‚Äù", options: ["falls", "fall", "is fall", "falles"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'falls'." },
    { prompt: "Corrige: ‚Äú‚Ä¶on weekends and holidays he love to fly airplanes‚Ä¶‚Äù", options: ["he loves to fly", "he love to fly", "he is love to fly", "he loved to fly"], correctIndex: 0, explanation: "3¬™ persona ‚áí 'loves'." },
    { prompt: "Comprensi√≥n: ‚ÄúFive o‚Äôclock is his favorite time of the day.‚Äù ¬øPor qu√©? Selecciona la opci√≥n correcta.", options: ["Porque termina el trabajo y vuelve a casa", "Porque empieza el trabajo", "Porque se acuesta a esa hora", "Porque va al cine"], correctIndex: 0, explanation: "Seg√∫n el texto, a las cinco termina y regresa con su familia." },
    { prompt: "Dato del texto: ¬øC√≥mo se llaman sus hijos?", options: ["Thomas y Patrick", "John y Peter", "Mike y Judy", "Steven y Mary"], correctIndex: 0, explanation: "El texto dice: Thomas (6) y Patrick (8)." },
  ];

  // ===== Motor de cuestionarios =====
  const sections = {
    adv: { elQuiz: $('#adv-quiz'), elStats: $('#adv-stats'), elProgress: $('#adv-progress'), questions: advQuestions, streak:0 },
    pres: { elQuiz: $('#pres-quiz'), elStats: $('#pres-stats'), elProgress: $('#pres-progress'), questions: presQuestions, streak:0 },
    edit: { elQuiz: $('#edit-quiz'), elStats: $('#edit-stats'), elProgress: $('#edit-progress'), questions: editQuestions, streak:0 },
  };

  let appState = loadState();
  for (const key of Object.keys(sections)) {
    if (!appState[key]) appState[key] = { order: [], answered: {}, correct: 0, wrong: 0, streak: 0 };
  }

  function initSection(key) {
    const sec = sections[key];
    if (!appState[key].order.length) appState[key].order = shuffle([...sec.questions.keys()]);
    renderSection(key); updateStats(key); updateGlobal();
  }

  function renderSection(key) {
    const sec = sections[key]; const container = sec.elQuiz; container.innerHTML = '';
    const order = appState[key].order;
    order.forEach((qIndex, idx) => {
      const q = sec.questions[qIndex];
      const optionIndices = shuffle([0,1,2,3]);
      const correctIdxShuffled = optionIndices.indexOf(q.correctIndex);

      const card = document.createElement('article');
      card.className = 'rounded-xl border p-4 shadow-sm bg-white/70 dark:bg-slate-900/40 animate-pop';
      card.setAttribute('role','group');
      card.innerHTML = `
        <div class="flex items-start justify-between gap-3">
          <div class="flex-1">
            <div class="text-slate-800 dark:text-slate-100 font-medium">${q.prompt}</div>
            <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-2" role="radiogroup" aria-label="Opciones">
              ${optionIndices.map((optIdx, i) => `
                <button class="option relative overflow-hidden focus-ring px-3 py-2 text-left rounded-lg border bg-slate-50 hover:bg-bwTeal/10 dark:bg-slate-900 dark:hover:bg-slate-800 transition transform active:scale-[.98]" role="radio" aria-checked="false" data-correct="${i===correctIdxShuffled}" data-qkey="${key}" data-qindex="${qIndex}">
                  ${q.options[optIdx]}
                </button>
              `).join('')}
            </div>
            <div class="mt-2 h-6 text-sm" aria-live="polite"></div>
          </div>
          <div class="ml-2 shrink-0">
            <span class="inline-flex items-center justify-center rounded-full h-7 w-7 bg-bwTeal/20 text-bwNavy text-sm">${idx+1}</span>
          </div>
        </div>
      `;
      card.addEventListener('click', (e) => { if (e.target.closest('button.option')) addRipple(e); });
      const answered = appState[key].answered[qIndex]; if (answered) lockCard(card, answered.correct, sec.questions[qIndex], answered.chosenText);
      container.appendChild(card);
    });

    container.addEventListener('click', (e) => {
      const btn = e.target.closest('button.option'); if (!btn) return;
      if (btn.closest('article').classList.contains('disabled')) return;

      const correct = btn.dataset.correct === 'true';
      const qIndex = parseInt(btn.dataset.qindex);
      const chosenText = btn.textContent.trim();
      const q = sections[key].questions[qIndex];
      btn.classList.add('animate-bounceTap');

      lockCard(btn.closest('article'), correct, q, chosenText);

      appState[key].answered[qIndex] = { correct, chosenText };
      if (correct) { appState[key].correct++; appState[key].streak++; successFX(); }
      else { appState[key].wrong++; appState[key].streak = 0; showToast('Respuesta incorrecta. ¬°T√∫ puedes! ‚ú®', false); }
      saveState(appState); updateStats(key); updateGlobal();
    });
  }

  const messages = ['¬°Bien! üöÄ','¬°Excelente! üåü','¬°A tope! üí™','¬°S√∫per! üî•','¬°Genial! ‚úÖ','¬°As√≠ se hace! üôå'];
  function successFX() { showToast(messages[Math.floor(Math.random()*messages.length)], true); confettiBurst(); }

  function lockCard(card, correct, q, chosenText) {
    card.classList.add('disabled');
    const options = $$('.option', card);
    options.forEach(o => o.classList.add('pointer-events-none'));
    options.forEach(o => {
      const isCorrect = o.getAttribute('data-correct') === 'true';
      o.classList.remove('border'); o.classList.add(isCorrect ? 'border-bwTeal' : 'border-slate-200');
      if (isCorrect) o.classList.add('bg-bwTeal/20');
      if (!isCorrect && o.textContent.trim()===chosenText && !correct) o.classList.add('bg-rose-50','dark:bg-rose-900/30','border-rose-400');
    });
    const feedback = $('div[aria-live]', card);
    feedback.textContent = correct ? ('¬°Correcto! ' + (q.explanation || '')) : (`Respuesta incorrecta. La correcta es: ‚Äú${q.options[q.correctIndex]}‚Äù. ${q.explanation || ''}`);
  }

  function updateStats(key) {
    const sec = sections[key];
    const total = sec.questions.length;
    const answeredCount = Object.keys(appState[key].answered).length;
    const remaining = total - answeredCount;
    sec.elStats.textContent = `Aciertos: ${appState[key].correct} ¬∑ Fallos: ${appState[key].wrong} ¬∑ Restantes: ${remaining} ¬∑ Racha: ${appState[key].streak}`;
    const pct = Math.round((answeredCount/total)*100);
    sec.elProgress.style.width = pct + '%';
  }
  function updateGlobal() {
    const keys = Object.keys(sections);
    const totals = keys.map(k => sections[k].questions.length).reduce((a,b)=>a+b,0);
    const answered = keys.map(k => Object.keys(appState[k].answered).length).reduce((a,b)=>a+b,0);
    const correct = keys.map(k => appState[k].correct).reduce((a,b)=>a+b,0);
    const wrong = keys.map(k => appState[k].wrong).reduce((a,b)=>a+b,0);
    $('#global-stats').textContent = `Global ¬∑ Aciertos: ${correct} ¬∑ Fallos: ${wrong} ¬∑ Contestadas: ${answered} / ${totals}`;
    $('#global-progress').style.width = Math.round(answered/totals*100) + '%';
  }

  function resetSection(key) {
    appState[key] = { order: shuffle([...sections[key].questions.keys()]), answered: {}, correct: 0, wrong: 0, streak: 0 };
    saveState(appState);
    renderSection(key); updateStats(key); updateGlobal();
    showToast('Secci√≥n reiniciada. ¬°A por todas!');
  }
  function resetAll() {
    for (const key of Object.keys(sections)) appState[key] = { order: shuffle([...sections[key].questions.keys()]), answered: {}, correct: 0, wrong: 0, streak: 0 };
    saveState(appState);
    for (const key of Object.keys(sections)) renderSection(key), updateStats(key);
    updateGlobal(); showToast('Todo reiniciado. üöÄ ¬°Comienza tu mejor marca!');
  }

  // Tabs y accesibilidad
  function setActivePanel(id) {
    $$('.panel').forEach(p => p.classList.add('hidden'));
    const panel = document.getElementById(id); panel.classList.remove('hidden');
    $$('.tab').forEach(t => t.dataset.active = 'false');
    const tab = $(`.tab[data-target="${id}"]`); tab.dataset.active = 'true'; tab.focus();
  }
  $$('.tab').forEach(tab => {
    tab.addEventListener('click', (e) => { addRipple(e); setActivePanel(tab.dataset.target); });
    tab.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setActivePanel(tab.dataset.target); } });
  });

  // Tema
  const themeToggle = document.getElementById('themeToggle');
  const THEME_KEY = 'theme-dark';
  const initTheme = () => { const on = localStorage.getItem(THEME_KEY) === '1'; document.documentElement.classList.toggle('dark', on); themeToggle.checked = on; };
  themeToggle.addEventListener('change', (e) => { const on = themeToggle.checked; document.documentElement.classList.toggle('dark', on); localStorage.setItem(THEME_KEY, on ? '1':'0'); showToast(on? 'Modo oscuro activado üåô':'Modo claro ‚òÄÔ∏è'); });
  initTheme();

  // Botones globales
  $('#resetAllBtn').addEventListener('click', (e)=>{ addRipple(e); resetAll(); });
  $('#resetAllBtn2').addEventListener('click', (e)=>{ addRipple(e); resetAll(); });
  $('#resetSectionBtn').addEventListener('click', (e)=>{ addRipple(e); const visible = $$('.panel').find(p=>!p.classList.contains('hidden')); if (visible) resetSection(visible.id.split('-')[1]); });
  $('#clearStorageBtn').addEventListener('click', (e)=>{ addRipple(e); localStorage.removeItem(STORAGE_KEY); localStorage.removeItem(THEME_KEY); showToast('Datos borrados.'); });

  // Inicializaci√≥n
  function initAll() { initSection('adv'); initSection('pres'); initSection('edit'); setActivePanel('panel-adv'); }
  initAll();
  </script>
</body>
</html>
